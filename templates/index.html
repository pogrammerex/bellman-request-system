<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bellman Request System</title>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script> <!-- Include SocketIO library -->
    <style>
        /* Your styling here */
    </style>
</head>
<body>
    <h1>Bellman Requests</h1>

    <!-- The table where requests will be added dynamically -->
    <table id="requests-table">
        <thead>
            <tr>
                <th>Room Number</th>
                <th>In Progress</th>
                <th>Finished</th>
            </tr>
        </thead>
        <tbody>
            {% for req in requests %}
            <tr id="row-{{ req.id }}">
                <td>{{ req.room }}</td>
                <td>
                    <form action="/update/{{ req.id }}/in-progress" method="POST">
                        <input type="checkbox" onclick="this.form.submit()" {% if req.status == 'In Progress' %}checked{% endif %}>
                    </form>
                </td>
                <td>
                    <form action="/finish/{{ req.id }}" method="POST">
                        <input type="checkbox" onclick="this.form.submit()" {% if req.status == 'Finished' %}checked{% endif %}>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Notification Sound -->
    <audio id="notification-sound" src="{{ url_for('static', filename='notification.wav') }}" preload="auto"></audio>

    <script type="text/javascript">
        var socket = io();  // Connect to SocketIO

        // Function to play the notification sound
        function playNotificationSound() {
            var audio = document.getElementById('notification-sound');
            if (audio) {
                audio.currentTime = 0;  // Reset the audio to start from the beginning
                audio.play().catch(function(error) {
                    console.log("Audio playback failed:", error);
                });
            } else {
                console.log("Audio element not found!");
            }
        }

        // Function to dynamically add a row to the table for a new request
        function addRequestToTable(room_number) {
            var tbody = document.querySelector('#requests-table tbody');
            var newRow = document.createElement('tr');

            newRow.innerHTML = `
                <td>Room ${room_number}</td>
                <td>
                    <form action="/update/in-progress" method="POST">
                        <input type="checkbox" onclick="this.form.submit()">
                    </form>
                </td>
                <td>
                    <form action="/finish" method="POST">
                        <input type="checkbox" onclick="this.form.submit()">
                    </form>
                </td>
            `;

            tbody.appendChild(newRow);
        }

        // Listen for updates from the server
        socket.on('update_requests', function(data) {
            console.log("New request for room:", data.room_number);

            // Play the notification sound
            playNotificationSound();

            // Dynamically add the new request to the table without reloading
            addRequestToTable(data.room_number);
        });
    </script>

    <!-- Copyright Notice -->
    <div class="copyright">
        &copy; 2024 Meshal Bahaddad (Rex Tenison)
    </div>
</body>
</html>
